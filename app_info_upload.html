<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <!--移动端必须要设置的适配-->
    <meta name='viewport' content='width=device-width, user-scalable=no, initial-scale=1.0'>
    <title>Title</title>
    <link rel='stylesheet' href='css/base.css'>
    <script type='text/javascript' src='./js/jqeury.min.js'></script>
    <style>
        body {
            word-break: break-all;
            color: #555555;
            font-family: 'Microsoft YaHei', sans-serif;
            font-size: 12px;
            -webkit-font-smoothing: antialiased;
            -moz-font-smoothing: antialiased;/*兼容火狐*/
            background-image:url('./image/bg_info.png');
            background-size: 100%;
        }
        div{
            display: flex;
            flex-direction: column;
        }
        .img_logo{
            display: block;
            height:80px;
            width: 80px;
            border-radius: 50%;
            margin: 20px auto;
        }

        .input_txt{
            height:40px;
            width: 80%;
            background: white;
            border: 1px solid #eee;
            margin: 5px auto 0 auto;
            padding:0 16px;
            border-radius: 4px;
        }
        .input_textarea{
            height:80px;
            width: 80%;
            background: white;
            border: 1px solid #eee;
            margin: 5px auto 0 auto;
            padding:10px 16px;
            border-radius: 4px;
            vertical-align: top;
        }
        .input_photo{
            margin: 10px auto 0 auto;
            height:40px;
            width: 80%;
        }
        .input_commit{
            height:40px;
            width: 80%;
            margin: 0 auto;
            border-radius: 4px;
            background: rgba(255,255,255,0.8);
            font-size: 14px;
        }
        .input_commit:hover{
            background: rgba(255,255,255,0.6);
        }
        #photo_result{
            display: block;
            margin: 10px auto;
        }
        .desc{
            text-align: center;
            margin: 10px auto;
        }
    </style>
    <script type='text/javascript'>
        var $j = jQuery.noConflict();
        $j(function(){
            var input_phone = $j('#input_phone'),
                input_name = $j('#input_name'),
                input_commit = $j('#input_commit'),
                input_address = $j('#input_address'),
                photo_choice = $j('#photo_choice');
            var imgData = '';
            var committing = false;

            input_commit.click(function () {
                var input_phone_val = input_phone.val();
                var input_name_val = input_name.val();
                var input_address_val = input_address.val();
                if(!(input_phone_val && input_name_val && input_address_val)){
                    alert('请输入电话/姓名/联系地址');
                    return;
                }
                if(!imgData){
                    alert('请选择图片');
                    return;
                }
                commit(input_phone_val,input_name_val,input_address_val);
            });
            function commit(input_phone_val,input_name_val,input_address_val) {
                if(committing){
                    return;
                }
                committing = true;
                //TODO。。提示加载中
                $j.ajax({
                    type: 'GET',
                    url: 'https://www.cookteching.com/food-sys/api/album/album/list.htm?location=below&r='+Math.random(),
                    success: function(data){
                        committing = false;
                        alert('提交成功')
                        input_phone.val('');
                        input_name.val('');
                        input_address.val('');
                        photo_choice.val('');
                        imgData = '';
                    },
                    error:function(){
                        committing = false;
                        alert('出错了')
                    }
                });
            }

            if(typeof FileReader==='undefined'){
                photo_choice.setAttribute('disabled','disabled');
            }else{
                photo_choice.addEventListener('change',readFile,false);
            }
            function readFile(){
                for(var i=0;i<this.files.length;i++){
                    if (!photo_choice['value'].match(/.jpg|.gif|.png|.bmp|.JPG|.GIF|.PNG|.BMP/i)){　　//判断上传文件格式
                        imgData = '';
                        return alert('上传的图片格式不正确，请重新选择')
                    }
                    var reader = new FileReader();
                    reader.readAsDataURL(this.files[i]);
                    reader.onload = function(e){
                        var img = document.getElementById('photo_result')
                        img.src = this.result;
                        imgData = this.result;
                        img.onload = function(){
                            // 打印
                            img.style.width = 200+'px';
                            img.style.height = img.height/img.width*200 + 'px';
                        };
                    }
                }
            }
        });
    </script>
</head>
<body id='body'>
    <img src='./image/logo.jpg' class='img_logo'>
    <div>
        <input id='input_name' class='input_txt' type='text' placeholder='输入姓名'>
        <input id='input_phone' class='input_txt' type='text' placeholder='输入手机'>
        <textarea id='input_address' class='input_textarea' placeholder='输入地址'></textarea>
        <input id='photo_choice'  class='input_photo' type='file' placeholder='请选择一张图片' accept='image/*' multiple>
        <input id='input_commit' class='input_commit' type='submit' value='提交'/>
    </div>
    <div class='desc'> 本界面由小程序 '菜快来' 提供</div>
    <img id = 'photo_result'>
</body>
</html>